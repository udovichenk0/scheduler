'use strict';function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t,n,r){var o=[d.step.run({fn:function(e){return t(e)}})];if(r&&o.unshift(r),n){var u=d.createNode({node:o}),a=e.graphite.id,c=n.additionalLinks,i=c[a]||[];return c[a]=i,i.push(u),function(){var e=i.indexOf(u);-1!==e&&i.splice(e,1),d.clearNode(u)}}var s=d.createNode({node:o,parent:[e],family:{owners:e}});return function(){d.clearNode(s)}}function n(e,t){return t.displayName=e,t}function r(e,n){d.is.store(e)||h('expect useStore argument to be a store');var r=b.useCallback((function(r){return t(e,r,n)}),[e,n]),o=b.useCallback((function(){return x(e,n)}),[e,n]);return y.useSyncExternalStore(r,o,o)}function o(e,n){var r=d.is.unit(e),o={};r?o={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?o=e['@@unitShape']():h('expect @@unitShape to be a function'):o=e;var u=Array.isArray(o),a=b.useRef({stale:1,justSubscribed:0,scope:n}),c=b.useMemo((function(){a.current.stale=1;var e=Array.isArray(o)?[]:{},t=[],r=[];for(var u in o){var c=o[u];d.is.unit(c)||h('expect useUnit argument to be a unit'),d.is.event(c)||d.is.effect(c)?e[u]=n?d.scopeBind(c,{scope:n}):c:(e[u]=null,t.push(u),r.push(c))}return[e,t,r]}),[a,n].concat(Object.keys(o),Object.values(o))),i=c[0],s=c[1],f=c[2],l=b.useRef({value:i,storeKeys:s}),p=b.useCallback((function(e){var r=a.current;r.justSubscribed=1;var o=function(){r.stale||(r.stale=1,e())},u=d.step.compute({priority:'sampler',batch:1}),c=f.map((function(e){return t(e,o,n,u)}));return function(){c.forEach((function(e){return e()}))}}),[f,n,l,a]),v=b.useCallback((function(){var e,t=l.current,o=a.current,c=0,p=t.value,v=t.storeKeys,d=n!==o.scope;if(o.stale||o.justSubscribed||d){c=!o.justSubscribed||d,e=u?[].concat(i):Object.assign({},i),v.length!==s.length&&(c=1);for(var y=0;y<s.length;y++){var m=x(f[y],n),b=s[y];c||(c=v.includes(b)?p[b]!==m:1),e[b]=m}}return c&&(t.value=e),t.storeKeys=s,o.stale=0,o.justSubscribed=!c,o.scope=n,r?t.value.unit:t.value}),[p,f,n,l,a]);return y.useSyncExternalStore(p,v,v)}function u(e,n){var r,o,u,a,c=e[0],i=e[1],s=g;if(i)r=i,u=c,a=[];else{r=c.fn,u=c.store,a=c.keys,o=c.defaultValue;var f=c.updateFilter;s=void 0===f?g:f}d.is.store(u)||h('useStoreMap expects a store'),Array.isArray(a)||h('useStoreMap expects an array as keys'),'function'!=typeof r&&h('useStoreMap expects a function');var l=b.useCallback((function(e){return t(u,e,n)}),[u,n]),p=b.useCallback((function(){return x(u,n)}),[u,n]),v=b.useRef(),y=b.useRef(),S=b.useRef(a);return m.useSyncExternalStoreWithSelector(l,p,p,(function(e){if(v.current!==e||!function(e,t){if(!e||!t||e.length!==t.length)return 0;for(var n=1,r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n}(S.current,a)){var t=r(e,a);void 0===t&&void 0!==o&&(t=o),v.current=e,S.current=a,void 0!==t&&(y.current=t)}return y.current}),(function(e,t){return!s(t,e)}))}function a(e,t,n){void 0===t&&(t={});var r=o({open:e.open,close:e.close,set:e.set},n),u=r.open,a=r.close,c=r.set,i=b.useMemo((function(){return{open:u,close:a,set:c}}),[e,u]),s=b.useRef({value:null,count:0});S((function(){return i.open(s.current.value),function(){return i.close(s.current.value)}}),[i]),function(e,t){if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(var o=0;o<n.length;o++){var u=n[o];if(e[u]!==t[u])return 0}return 1}return 0}(s.current.value,t)||(s.current.value=t,s.current.count+=1),S((function(){i.set(s.current.value)}),[s.current.count])}function c(e){var t=b.useContext(k);return e&&!t&&h('No scope found, consider adding <Provider> to app root'),t}function i(e,t){return r(e,c(null==t?void 0:t.forceScope))}function s(e,t){function r(e){var n=b.useRef(e),r=i(o);S((function(){return a({props:n.current,state:o.getState()}),function(){c({props:n.current,state:o.getState()})}}),[]);var u=t(e,r);return n.current=e,u}var o;d.is.store(e)?o=e:'object'==typeof e&&null!==e?o=d.combine(e):h('shape should be a store or object with stores');var u='Unknown';o&&o.shortName&&(u=o.shortName);var a=d.createEvent(),c=d.createEvent();return r.mounted=a,r.unmounted=c,n(u+".View",r)}function f(e,t){var n,r=t?e:e[0];(function(e){if(!e)throw Error('expect first argument be an object')})(E(n=r)||function(e){return'function'==typeof e}(n));var o=r.or,u=r.and;if(u){var a=t?u:u[0];if(E(a)&&'and'in a){var c=f(u,t);e=c[0],o=Object.assign({},o,c[1])}else e=u}return[e,o]}function l(e){function t(e){return u(t,e,c()),null}var r=e.domain,o=e.defaultState,u=e.hook,a=w({or:e.maybeConfig,and:e.mainConfig}),i=(r?r.compositeName.fullName+"/":'')+(a.name||'gate'),s=d.createEvent({name:i+".set",sid:a.sid?a.sid+"|set":void 0}),f=d.createEvent({name:i+".open",sid:a.sid?a.sid+"|open":void 0}),l=d.createEvent({name:i+".close",sid:a.sid?a.sid+"|close":void 0}),p=d.createStore(Boolean(0),{name:i+".status",serialize:'ignore'}).on(f,(function(){return Boolean(1)})).on(l,(function(){return Boolean(0)})),v=d.createStore(o,{name:i+".state",sid:a.sid}).on(s,(function(e,t){return t})).on(f,(function(e,t){return t})).reset(l);if(r){var y=r.hooks;d.launch({target:[y.store,y.store,y.event,y.event,y.event],params:[p,v,f,l,s]})}return t.open=f,t.close=l,t.status=p,t.state=v,t.set=s,n("Gate:"+i,t)}function p(e,t){var n,r,o,u=f(t&&E(n=t[0])&&(n.and||n.or)?t:[{and:t}]),a=u[0],c=a[0],i=a[1],s={},l={},p=u[1];return'string'==typeof c?(l={name:c},E(o=i)&&'sid'in o||(s=i||{})):function(e){return E(e)&&('domain'in e||'defaultState'in e||'name'in e)}(c)&&(l=c,s=c.defaultState||{},r=c.domain),{hook:e,domain:r,defaultState:s,mainConfig:l,maybeConfig:p}}Object.defineProperty(exports,'__esModule',{value:1});var v=require('react'),d=require('effector/compat'),y=require('use-sync-external-store/shim/index.js'),m=require('use-sync-external-store/shim/with-selector.js'),b=e(v),h=function(e){throw Error(e)},S='undefined'!=typeof window?b.useLayoutEffect:b.useEffect,x=function(e,t){return t?t.getState(e):e.getState()},g=function(e,t){return e!==t},k=b.createContext(null),j=function(e){return console.error(e+" is deprecated")},C=function(e){return function(t){var r=e;return'function'!=typeof e&&(r=t,t=e),n("Connect("+(r.displayName||r.name||'Unknown')+")",(function(e){return b.createElement(r,Object.assign({},e,i(t)))}))}},E=function(e){return'object'==typeof e&&null!==e},w=function e(t,n){return void 0===n&&(n={}),E(t)&&(e(t.or,n),function(e){for(var t in e)o=t,function(e){return void 0===e}(r=e[t])||'or'===o||'and'===o||(n[o]=r);var r,o}(t),e(t.and,n)),n};exports.Provider=k.Provider,exports.connect=C,exports.createComponent=s,exports.createContextComponent=function(e,t,r){return j('createContextComponent'),n((e.shortName||'Unknown')+".ContextComponent",(function(n){var o=b.useContext(t),u=i(e);return r(n,u,o)}))},exports.createGate=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l(p(a,t))},exports.createReactState=function(e,t){return j('createReactState'),C(t)(e)},exports.createStoreConsumer=function(e){return s(e,(function(e,t){return(0,e.children)(t)}))},exports.useEvent=function(e,t){return function(e,t){if(!t)return e;var n=d.is.unit(e)||'object'!=typeof e?{event:e}:e;return b.useMemo((function(){if(d.is.unit(e))return d.scopeBind(e,{scope:t});var n=Array.isArray(e)?[]:{};for(var r in e)n[r]=d.scopeBind(e[r],{scope:t});return n}),[t].concat(Object.keys(n),Object.values(n)))}(e,c(null==t?void 0:t.forceScope))},exports.useGate=function(e,t,n){return void 0===t&&(t={}),a(e,t,c(null==n?void 0:n.forceScope))},exports.useList=function(e,t,o){return function(e,t,o){var a,c,i,s=[];'object'==typeof t&&null!==t?(t.keys&&(s=t.keys),a=t.fn,c=t.getKey,i=t.placeholder):a=t,d.is.store(e)||h('expect useList first argument to be a store'),'function'!=typeof a&&h("expect useList's renderItem to be a function"),Array.isArray(s)||h("expect useList's keys to be an array");var f=b.useMemo((function(){var t=n((e.shortName||'Unknown')+".Item",(function(t){var n=t.index,r=t.keys;if(l.current[1])return l.current[0](t.value,t.keyVal);var a=u([{store:e,keys:[n].concat(r),fn:function(e,t){return e[t[0]]}}],o);return l.current[0](a,n)}));return b.memo(t)}),[e,o,!!c]),l=b.useRef([a,c]);l.current=[a,c];var p=b.useMemo((function(){return s}),s);if(c){var v=r(e,o);return 0===v.length&&i?i:v.map((function(e){var t=l.current[1](e);return b.createElement(f,{keyVal:t,key:t,keys:p,value:e})}))}var y=u([{store:e,keys:[e],fn:function(e){return e.length}}],o);return 0===y&&i?i:Array.from({length:y},(function(e,t){return b.createElement(f,{index:t,key:t,keys:p})}))}(e,t,c(null==o?void 0:o.forceScope))},exports.useStore=i,exports.useStoreMap=function(e,t){return u([e,t],c(null==e?void 0:e.forceScope))},exports.useUnit=function(e,t){return o(e,c(null==t?void 0:t.forceScope))};
//# sourceMappingURL=compat.js.map
